<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Green Earth — Plant a Tree</title>
  <link rel="stylesheet" href="styles/style.css" />
</head>
<body>

  <div class="container cusosada">

  </div>

   <!-- NAVBAR -->
  <header>
    <div class="container nav">
      <div class="brand">
        
        <div>
          <div style="font-weight:800">Green Earth</div>
          
        </div>
      </div>

      <nav class="hide-sm">
        <ul>
          <li><a href="#about">About</a></li>
          <li><a href="#trees">Gallery</a></li>
          <li><a href="#impact">Plant a Tree</a></li>
        </ul>
      </nav>
 <div>
        <button class="btn-cta">Plant a Tree</button>
      </div>
    </div>
  </header>
<!-- HERO -->
  <section class="hero">
    <img src="assets/hero-leaf1.png" alt="leaf" class="leaf-left" />
    <img src="assets/hero-leaf2.png" alt="leaf" class="leaf-right" />
    <div class="container">
      <div style="max-width:850px;margin:0 auto">
        <div class="title">Plant a Tree, Grow a Future</div>
        <div class="sub">Join our mission to plant 1 million trees and make the Earth greener for future <br>
generations.</div>
        <button class="btn-cta" onclick="document.getElementById('trees-section').scrollIntoView({behavior:'smooth'})">Get Involved</button>
      </div>
    </div>
  </section>
<!-- MAIN CONTENT -->
  <main class="container">
    <div class="main">

      <!-- CATEGORIES -->
      <aside>
        <div class="card categories">
          <h3 style="margin:0 0 10px 0">Categories</h3>
          <div id="categoryList">
            <!-- dynamic category buttons -->
            <div style="color:var(--muted);font-size:13px">Loading categories...</div>
          </div>
        </div>
      </aside>
       <!-- CARDS -->
      <section id="trees-section">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
          <h2 style="margin:0">Choose Your Trees</h2>
          <div id="status" class="muted"> </div>
        </div>

        <div class="card">
          <div id="cardsWrap" class="cards-grid">
            <!-- tree cards inserted here -->
          </div>

          <div id="spinner" class="spinner hidden">
            <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
          </div>

          <div id="noItems" class="muted" style="text-align:center;padding:18px;display:none">No trees found.</div>
        </div>
      </section>

      <!-- CART -->
      <aside>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Your Cart</h3>
            <button id="clearCartBtn" style="background:#eef7ef;border:none;padding:6px 10px;border-radius:8px;cursor:pointer">Clear</button>
          </div>

          <div id="cartList" class="cart-list" style="margin-top:12px">
            <div class="muted">No trees added yet.</div>
          </div>

          <div style="border-top:1px dashed #e6f0ea;margin-top:12px;padding-top:12px;display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Total</div>
            <div id="totalPrice" style="font-weight:800">৳ 0</div>
          </div>

          <button style="margin-top:12px;background:var(--green);color:white;border:none;padding:10px;border-radius:8px;cursor:pointer;width:100%">Checkout</button>
        </div>
      </aside>

    </div>
<!-- ABOUT -->
    <section id="about" class="section-about">
      <h2>About the Campaign</h2>
      <div class="two-col card" style="margin-top:12px;align-items:center">
        <img src="assets/about.png" alt="plant" style="width:100%;height:530px;border-radius:8px">
        <div class="about-text">
          <p style="color:var(--muted)">Green Earth is a global tree plantation initiative dedicated to fighting climate change. Since our start, we’ve planted over 500,000 trees worldwide. By joining our campaign, you help restore forests, create habitats for wildlife, and combat global warming.</p>
          <p style="margin-top:10px;" ><ul>
            <li class="about-list">Restoration of natural habitats</li>
            <li>Improvement of air quality</li>
            <li>for local communities</li>
          </ul></p>
        </div>
      </div>
    </section> 

  </main>
  <!-- IMPACT -->
      <section id="impact" class="impact-section" >
      <h2>Our Impact</h2>
      <div class="impact" style="margin-top:12px">
        <div class="stat card"><div style="font-size:20px;color:var(--success)">500K+</div><div class="muted">Trees Planted</div></div>
        <div class="stat card"><div style="font-size:20px;color:var(--success)">120+</div><div class="muted">Community Partners</div></div>
        <div class="stat card"><div style="font-size:20px;color:var(--success)">30+</div><div class="muted">Active Projects</div></div>
      </div>
    </section>
<!-- FORM -->
    <section class="section-form">
      <h2>Plant a Tree Today</h2>
      <div style="margin: 0px auto; max-width: 540px;" class="card1">
        <form id="donateForm" class="card2" onsubmit="return false">
          <div style="display:flex;flex-direction:column;gap:10px">
            <input id="donorName" placeholder="Your Name" required />
            <input id="donorEmail" type="email" placeholder="Email Address" required />
            <select id="donorQty">
              <option value="">Number of Trees</option>
              <option value="1">1</option>
              <option value="3">3</option>
              <option value="5">5</option>
              <option value="10">10</option>
            </select>
            <button id="donateBtn" style="background:var(--accent);border:none;padding:10px;border-radius:8px;cursor:pointer;font-weight:700">Donate Now</button>
          </div>
        </form>
      </div>
    </section>
  <footer>
    <div class="container">© 2025 Green Earth — All rights reserved.</div>
  </footer>
 <!-- MODAL -->
  <div id="modalBackdrop" class="modal-backdrop hidden" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="close" onclick="closeModal()">✕</button>
      <div id="modalContent"></div>
    </div>
  </div>

 <script>
    /* -------------------------
       Configuration & State
       ------------------------- */
    const API_ALL_PLANTS = 'https://openapi.programming-hero.com/api/plants';
    const API_ALL_CATS   = 'https://openapi.programming-hero.com/api/categories';
    const API_CAT        = id => `https://openapi.programming-hero.com/api/category/${id}`;
    const API_DETAIL     = id => `https://openapi.programming-hero.com/api/plant/${id}`;

    let cart = JSON.parse(localStorage.getItem('ge_cart') || '[]');
    let activeCategory = localStorage.getItem('ge_active_cat') || null;

    const categoryListEl = document.getElementById('categoryList');
    const cardsWrap = document.getElementById('cardsWrap');
    const spinner = document.getElementById('spinner');
    const noItems = document.getElementById('noItems');
    const status = document.getElementById('status');
    const cartList = document.getElementById('cartList');
    const totalPriceEl = document.getElementById('totalPrice');
    const clearCartBtn = document.getElementById('clearCartBtn');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalContent = document.getElementById('modalContent');

    /* -------------------------
       Helpers
       ------------------------- */
    function showSpinner(show){
      spinner.classList.toggle('hidden', !show);
    }
    function money(n){ return '৳ ' + (Number(n) || 0) }
    function saveCart(){
      localStorage.setItem('ge_cart', JSON.stringify(cart));
    }
    function saveActiveCategory(id){
      if(id) localStorage.setItem('ge_active_cat', id); else localStorage.removeItem('ge_active_cat');
    }

    function normalizePlant(p){
      // Make resilient to slight API differences
      return {
        id: p.id || p._id || p.plant_id || (p.plant && p.plant.id) || '',
        name: p.name || p.title || p.plant_name || (p.plant && p.plant.name) || 'Tree',
        price: Number(p.price || p.cost || p.amount || 0),
        category: p.category || p.category_name || p.type || '',
        image: p.image || p.img || p.thumbnail || 'https://images.unsplash.com/photo-1526401485004-2fda9f4b8d77?q=80&w=1000&auto=format&fit=crop',
        description: p.description || p.short_description || p.details || ''
      };
    }

    /* -------------------------
       Categories
       ------------------------- */
    async function loadCategories(){
      categoryListEl.innerHTML = '<div style="color:var(--muted);font-size:13px">Loading categories...</div>';
      try{
        const res = await fetch(API_ALL_CATS);
        const data = await res.json();
        const cats = data?.data || data?.categories || [];
        categoryListEl.innerHTML = '';
        // "All" button
        const allBtn = document.createElement('button');
        allBtn.textContent = 'All Trees';
        allBtn.onclick = ()=>{
          setActiveBtn(allBtn, null);
          loadAllPlants();
        };
        categoryListEl.appendChild(allBtn);

        cats.forEach(cat=>{
          const id = cat?.id || cat?.category_id || cat?._id || '';
          const label = cat?.category || cat?.category_name || cat?.name || 'Category';
          const btn = document.createElement('button');
          btn.textContent = label;
          btn.dataset.id = id;
          btn.onclick = ()=> { setActiveBtn(btn, id); onCategoryClick(id) };
          categoryListEl.appendChild(btn);
        });

        // set active if stored
        let btnToActivate = null;
        if(activeCategory){
          btnToActivate = [...categoryListEl.querySelectorAll('button')].find(b=> b.dataset.id === activeCategory);
        }
        if(!btnToActivate) btnToActivate = categoryListEl.querySelector('button'); // "All"

        if(btnToActivate) { setActiveBtn(btnToActivate, btnToActivate.dataset.id || null); if(btnToActivate.dataset.id) onCategoryClick(btnToActivate.dataset.id); else loadAllPlants(); }
      }catch(err){
        categoryListEl.innerHTML = '<div style="color:var(--danger);font-size:13px">Failed to load categories</div>';
        console.error(err);
      }
    }

    function setActiveBtn(btn, id){
      [...categoryListEl.querySelectorAll('button')].forEach(b=> b.classList.remove('active'));
      if(btn) btn.classList.add('active');
      activeCategory = id;
      saveActiveCategory(id);
    }

    /* -------------------------
       Plants / Cards
       ------------------------- */
    async function loadAllPlants(){
      status.textContent = 'Loading plants...';
      showSpinner(true);
      noItems.style.display = 'none';
      try{
        const res = await fetch(API_ALL_PLANTS);
        const data = await res.json();
        const plants = data?.data || data?.plants || [];
        renderCards(plants);
        status.textContent = '';
      }catch(err){
        console.error(err);
        status.textContent = 'Failed to load plants';
      }finally{ showSpinner(false) }
    }

    async function onCategoryClick(id){
      status.textContent = 'Loading category...';
      showSpinner(true);
      noItems.style.display = 'none';
      try{
        const res = await fetch(API_CAT(id));
        const data = await res.json();
        const plants = data?.data || data?.plants || [];
        renderCards(plants);
        status.textContent = '';
      }catch(err){
        console.error(err);
        status.textContent = 'Failed to load category';
        cardsWrap.innerHTML = '';
      }finally{ showSpinner(false) }
    }

    function renderCards(plants){
      cardsWrap.innerHTML = '';
      if(!plants || plants.length === 0){
        noItems.style.display = 'block';
        return;
      }
      noItems.style.display = 'none';
      plants.forEach(p=>{
        const plant = normalizePlant(p);
        const card = document.createElement('article');
        card.className = 'plant-card';
        card.innerHTML = `
          <img loading="lazy" src="${plant.image}" alt="${escapeHtml(plant.name)}" />
          <div class="body">
            <div class="plant-title" data-id="${plant.id}">${escapeHtml(plant.name)}</div>
            <div class="plant-desc">${escapeHtml((plant.description||'').slice(0,120))}${(plant.description && plant.description.length>120)?'...':''}</div>
            <div class="plant-meta">
              <div class="muted">${escapeHtml(plant.category || '—')}</div>
              <div style="font-weight:800">${money(plant.price)}</div>
            </div>
            <button class="add-btn">Add to Cart</button>
          </div>
        `;
        // listeners
        card.querySelector('.add-btn').addEventListener('click', ()=> addToCart({id:plant.id,name:plant.name,price:plant.price}));
        card.querySelector('.plant-title').addEventListener('click', ()=> openDetail(plant.id));
        cardsWrap.appendChild(card);
      });
    }

    /* -------------------------
       Detail modal
       ------------------------- */
    async function openDetail(id){
      modalContent.innerHTML = '<div style="padding:20px;text-align:center" class="muted">Loading...</div>';
      modalBackdrop.classList.remove('hidden');
      try{
        const res = await fetch(API_DETAIL(id));
        const data = await res.json();
        const p = normalizePlant(data?.data || data?.plant || data || {});
        modalContent.innerHTML = `
          <div style="display:grid;grid-template-columns:1fr;gap:12px">
            <img src="${p.image}" alt="${escapeHtml(p.name)}" style="width:100%;height:320px;object-fit:cover;border-radius:8px" />
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <h3 style="margin:0">${escapeHtml(p.name)}</h3>
                <div class="muted" style="margin-top:6px">${escapeHtml(p.category || '')}</div>
              </div>
              <div style="font-weight:800">${money(p.price)}</div>
            </div>
            <p class="muted">${escapeHtml(p.description || 'No description available.')}</p>
            <div style="display:flex;gap:8px">
              <button id="modalAddBtn" style="background:var(--success);color:white;padding:10px;border-radius:8px;border:none;cursor:pointer">Add to Cart</button>
              <button onclick="closeModal()" style="background:#eef7ef;border:none;padding:10px;border-radius:8px;cursor:pointer">Close</button>
            </div>
          </div>
        `;
        document.getElementById('modalAddBtn').addEventListener('click', ()=> { addToCart({id:p.id,name:p.name,price:p.price}); closeModal(); });
      }catch(err){
        console.error(err);
        modalContent.innerHTML = '<div style="padding:20px;text-align:center;color:var(--danger)">Failed to load details.</div>';
      }
    }
    function closeModal(e){
      if(e && e.target !== modalBackdrop) return;
      modalBackdrop.classList.add('hidden');
      modalContent.innerHTML = '';
    }

    /* -------------------------
       Cart management
       ------------------------- */
    function addToCart(item){
      cart.push(item);
      saveCart();
      renderCart();
    }
    function removeFromCart(index){
      if(index>=0 && index<cart.length) cart.splice(index,1);
      saveCart();
      renderCart();
    }
    function clearCart(){
      if(!confirm('Clear the cart?')) return;
      cart = [];
      saveCart();
      renderCart();
    }
    function renderCart(){
      cartList.innerHTML = '';
      if(cart.length === 0){
        cartList.innerHTML = '<div class="muted">No trees added yet.</div>';
      } else {
        cart.forEach((c,idx)=>{
          const r = document.createElement('div');
          r.className = 'cart-row';
          r.innerHTML = `<div class="name">${escapeHtml(c.name)}</div>
                         <div style="display:flex;align-items:center;gap:10px">
                           <div class="price">${money(c.price)}</div>
                           <button class="remove" title="Remove">✖</button>
                         </div>`;
          r.querySelector('.remove').addEventListener('click', ()=> removeFromCart(idx));
          cartList.appendChild(r);
        });
      }
      const sum = cart.reduce((acc,c)=> acc + (Number(c.price)||0), 0);
      totalPriceEl.textContent = money(sum);
    }

    clearCartBtn.addEventListener('click', clearCart);

    /* -------------------------
       Donate form (simple feedback)
       ------------------------- */
    document.getElementById('donateBtn').addEventListener('click', ()=>{
      const name = document.getElementById('donorName').value.trim();
      const email = document.getElementById('donorEmail').value.trim();
      const qty = document.getElementById('donorQty').value;
      if(!name || !email || !qty){ alert('Please fill all fields.'); return; }
      alert(`Thank you ${name}! Donation request (${qty} tree(s)) received.`)
      document.getElementById('donorName').value = '';
      document.getElementById('donorEmail').value = '';
      document.getElementById('donorQty').value = '';
    });

    /* -------------------------
       Utilities
       ------------------------- */
    function escapeHtml(s){
      if(!s) return '';
      return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;');
    }

    /* -------------------------
       Init
       ------------------------- */
    (function init(){
      renderCart();
      loadCategories();
      // if no active category stored, load all
      if(!activeCategory) loadAllPlants();
    })();
  </script>


</body>
</html>